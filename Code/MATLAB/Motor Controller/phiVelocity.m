function [dThetaBasedt, dPhiBasedt, dPhiArmdt] = phiVelocity(vx, vy, vz, Px, Py, Pz, L1, L2)

    dPhiBasedx = - (Px ./ (L1 .* (Px .^ 2 + Py .^ 2 + Pz .^ 2) .^ 0.5000) - (0.5000 .* Px .* (L1 .^ 2 - L2 .^ 2 + Px .^ 2 + Py .^ 2 + Pz .^ 2)) ./ (L1 .* (Px .^ 2 + Py .^ 2 + Pz .^ 2) .^ 1.5000)) ./ (1 - (0.2500 .* (L1 .^ 2 - L2 .^ 2 + Px .^ 2 + Py .^ 2 + Pz .^ 2) .^ 2) ./ (L1 .^ 2 .* (Px .^ 2 + Py .^ 2 + Pz .^ 2))) .^ 0.5000 - (Px .* Pz) ./ ((Pz .^ 2 ./ (Px .^ 2 + Py .^ 2) + 1) .* (Px .^ 2 + Py .^ 2) .^ 1.5000);

    dPhiBasedy = - (Py ./ (L1 .* (Px .^ 2 + Py .^ 2 + Pz .^ 2) .^ 0.5000) - (0.5000 .* Py .* (L1 .^ 2 - L2 .^ 2 + Px .^ 2 + Py .^ 2 + Pz .^ 2)) ./ (L1 .* (Px .^ 2 + Py .^ 2 + Pz .^ 2) .^ 1.5000)) ./ (1 - (0.2500 .* (L1 .^ 2 - L2 .^ 2 + Px .^ 2 + Py .^ 2 + Pz .^ 2) .^ 2) ./ (L1 .^ 2 .* (Px .^ 2 + Py .^ 2 + Pz .^ 2))) .^ 0.5000 - (Py .* Pz) ./ ((Pz .^ 2 ./ (Px .^ 2 + Py .^ 2) + 1) .* (Px .^ 2 + Py .^ 2) .^ 1.5000);

    dPhiBasedz = 1 ./ ((Pz .^ 2 ./ (Px .^ 2 + Py .^ 2) + 1) .* (Px .^ 2 + Py .^ 2) .^ 0.5000) - (Pz ./ (L1 .* (Px .^ 2 + Py .^ 2 + Pz .^ 2) .^ 0.5000) - (0.5000 .* Pz .* (L1 .^ 2 - L2 .^ 2 + Px .^ 2 + Py .^ 2 + Pz .^ 2)) ./ (L1 .* (Px .^ 2 + Py .^ 2 + Pz .^ 2) .^ 1.5000)) ./ (1 - (0.2500 .* (L1 .^ 2 - L2 .^ 2 + Px .^ 2 + Py .^ 2 + Pz .^ 2) .^ 2) ./ (L1 .^ 2 .* (Px .^ 2 + Py .^ 2 + Pz .^ 2))) .^ 0.5000;


    dPhiBasedt = dPhiBasedx .* vx + dPhiBasedy .* vy + dPhiBasedz .* vz;


    dPhiArmdx = Px ./ (L1 .* L2 .* (1 - (0.2500 .* (- L1 .^ 2 - L2 .^ 2 + Px .^ 2 + Py .^ 2 + Pz .^ 2) .^ 2) ./ (L1 .^ 2 .* L2 .^ 2)) .^ 0.5000) - (Px .* Pz) ./ ((Pz .^ 2 ./ (Px .^ 2 + Py .^ 2) + 1) .* (Px .^ 2 + Py .^ 2) .^ 1.5000) - (Px ./ (L1 .* (Px .^ 2 + Py .^ 2 + Pz .^ 2) .^ 0.5000) - (0.5000 .* Px .* (L1 .^ 2 - L2 .^ 2 + Px .^ 2 + Py .^ 2 + Pz .^ 2)) ./ (L1 .* (Px .^ 2 + Py .^ 2 + Pz .^ 2) .^ 1.5000)) ./ (1 - (0.2500 .* (L1 .^ 2 - L2 .^ 2 + Px .^ 2 + Py .^ 2 + Pz .^ 2) .^ 2) ./ (L1 .^ 2 .* (Px .^ 2 + Py .^ 2 + Pz .^ 2))) .^ 0.5000;

    dPhiArmdy = Py ./ (L1 .* L2 .* (1 - (0.2500 .* (- L1 .^ 2 - L2 .^ 2 + Px .^ 2 + Py .^ 2 + Pz .^ 2) .^ 2) ./ (L1 .^ 2 .* L2 .^ 2)) .^ 0.5000) - (Py .* Pz) ./ ((Pz .^ 2 ./ (Px .^ 2 + Py .^ 2) + 1) .* (Px .^ 2 + Py .^ 2) .^ 1.5000) - (Py ./ (L1 .* (Px .^ 2 + Py .^ 2 + Pz .^ 2) .^ 0.5000) - (0.5000 .* Py .* (L1 .^ 2 - L2 .^ 2 + Px .^ 2 + Py .^ 2 + Pz .^ 2)) ./ (L1 .* (Px .^ 2 + Py .^ 2 + Pz .^ 2) .^ 1.5000)) ./ (1 - (0.2500 .* (L1 .^ 2 - L2 .^ 2 + Px .^ 2 + Py .^ 2 + Pz .^ 2) .^ 2) ./ (L1 .^ 2 .* (Px .^ 2 + Py .^ 2 + Pz .^ 2))) .^ 0.5000;

    dPhiArmdz = 1 ./ ((Pz .^ 2 ./ (Px .^ 2 + Py .^ 2) + 1) .* (Px .^ 2 + Py .^ 2) .^ 0.5000) - (Pz ./ (L1 .* (Px .^ 2 + Py .^ 2 + Pz .^ 2) .^ 0.5000) - (0.5000 .* Pz .* (L1 .^ 2 - L2 .^ 2 + Px .^ 2 + Py .^ 2 + Pz .^ 2)) ./ (L1 .* (Px .^ 2 + Py .^ 2 + Pz .^ 2) .^ 1.5000)) ./ (1 - (0.2500 .* (L1 .^ 2 - L2 .^ 2 + Px .^ 2 + Py .^ 2 + Pz .^ 2) .^ 2) ./ (L1 .^ 2 .* (Px .^ 2 + Py .^ 2 + Pz .^ 2))) .^ 0.5000 + Pz ./ (L1 .* L2 .* (1 - (0.2500 .* (- L1 .^ 2 - L2 .^ 2 + Px .^ 2 + Py .^ 2 + Pz .^ 2) .^ 2) ./ (L1 .^ 2 .* L2 .^ 2)) .^ 0.5000)


    dPhiArmdt = dPhiArmdx .* vx + dPhiArmdy .* vy + dPhiArmdz .* vz;


    dThetaBasedx = 1 ./ Px .* 1 ./ (1 + (Py ./ Px) .^ 2);

    dThetaBasedy = Py .* log(Px) .* 1 ./ (1 + (Py ./ Px) .^ 2);

    dThetaBasedz = 0;


    dThetaBasedt = dThetaBasedx .* vx + dThetaBasedy .* vy + dThetaBasedz .*  vz;
end